<!-- Para produção/Vercel, injete este script para apontar para o serviço Render -->
<script>
  window.CAPTURE_ENDPOINT = "https://SEU-SERVICO.onrender.com/capture";
</script>

<!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
      // ===== STATELESS MODE =====
      (function () {
        const PREFIXES = [
          "sicredi_",
          "shots",
          "captured",
          "comments",
          "comment",
          "analise",
          "criticos",
          "resumo",
          "status",
          "templates",
          "pages",
          "sicredi_shots_v1",
          "sicredi_comments_v1",
          "sicredi_status_v1",
        ];

        function clearAppStorage() {
          const shouldClear = (key) =>
            PREFIXES.some((p) => key === p || key.startsWith(p));
          for (const store of [localStorage, sessionStorage]) {
            const keys = [];
            for (let i = 0; i < store.length; i++) keys.push(store.key(i));
            keys.forEach((k) => {
              if (shouldClear(k)) store.removeItem(k);
            });
          }
        }

        clearAppStorage();

        const _setItem = localStorage.setItem.bind(localStorage);
        const _getItem = localStorage.getItem.bind(localStorage);
        const _removeItem = localStorage.removeItem.bind(localStorage);

        const isOurKey = (k) =>
          !!k && PREFIXES.some((p) => k === p || k.startsWith(p));

        localStorage.setItem = (k, v) => {
          if (isOurKey(k)) sessionStorage.setItem(k, v);
          else _setItem(k, v);
        };
        localStorage.getItem = (k) => {
          if (isOurKey(k)) return sessionStorage.getItem(k);
          return _getItem(k);
        };
        localStorage.removeItem = (k) => {
          if (isOurKey(k)) sessionStorage.removeItem(k);
          else _removeItem(k);
        };

        window.addEventListener("pageshow", (e) => {
          if (e.persisted) clearAppStorage();
        });
      })();

      // ===== CONFIG =====
      const CONFIG = {
        STORAGE_KEYS: {
          PAGES: "sicredi_pages_v2",
          COMMENTS: "sicredi_comments_v2",
          STATUS: "sicredi_status_v2",
          SHOTS: "sicredi_shots_v1",
          AUTO_SAVE: "sicredi_report_v3_",
          TEMPLATES: "sicredi_templates_v3",
        },
        PDF: {
          MARGINS: 12,
          DEFAULT_FILENAME: "relatorio-sicredi",
          QUALITY: 0.95,
        },
        DEBOUNCE_DELAY: 300,
        AUTOSAVE_DELAY: 2000,
      };

      // PATCH: endpoint configurável
      const CAPTURE_ENDPOINT = window.CAPTURE_ENDPOINT || "http://localhost:3001/capture";

      // ===== STATE =====
      let pages = [];
      let currentIndex = 0;

      // ===== INIT =====
      document.addEventListener("DOMContentLoaded", async () => {
        let fetchedPages;
        try {
          const response = await fetch("./pages-config.json");
          fetchedPages = await response.json();
        } catch (err) {
          console.error("Falha ao carregar pages-config.json:", err);
          fetchedPages = [
            {
              title: "Página inicial padrão",
              src: "about:blank",
              width: "600",
              height: "1000",
            },
          ];
        }

        pages = fetchedPages;

        setupAutoSave();
        setupKeyboardNavigation();

        renderCurrentPage(0);
        renderDashboardList();
        refreshHeaderInfo();
        updateRemoveButton();
        atualizarSaida();

        const frame = document.getElementById("reportFrame");
        frame.addEventListener("load", () => {
          document.getElementById("iframeSkeleton").style.display = "none";
        });
      });

      // ===== MOBILE SIDEBAR =====
      function toggleMobileSidebar() {
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.mobile-sidebar-overlay');
        sidebar.classList.toggle('show');
        overlay.classList.toggle('show');
      }

      // ===== STEP NAVIGATION =====
      function setActiveStep(index) {
        const steps = document.querySelectorAll('.step');
        steps.forEach((step, i) => {
          step.classList.toggle('active', i === index);
        });
      }

      // ===== PERSISTENCE =====
      function loadPages() {
        try {
          return JSON.parse(
            localStorage.getItem(CONFIG.STORAGE_KEYS.PAGES) || "[]"
          );
        } catch {
          return [];
        }
      }

      function persistPages() {
        localStorage.setItem(CONFIG.STORAGE_KEYS.PAGES, JSON.stringify(pages));
      }

      // ===== SCREENSHOTS =====
      function loadShots() {
        try {
          return JSON.parse(
            localStorage.getItem(CONFIG.STORAGE_KEYS.SHOTS) || "{}"
          );
        } catch {
          return {};
        }
      }

      function saveShots(map) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.SHOTS, JSON.stringify(map));
      }

      function getShotForPage(p) {
        const map = loadShots();
        return map[pageKey(p)] || null;
      }

      function setShotForPage(p, dataUrl) {
        const map = loadShots();
        map[pageKey(p)] = dataUrl;
        saveShots(map);
      }

      // ===== NAVIGATION =====
      function prevPage() {
        let newIndex = currentIndex - 1;
        if (newIndex >= 0) {
          selectPage(newIndex);
        }
      }

      function nextPage() {
        let newIndex = currentIndex + 1;
        if (newIndex < pages.length) {
          selectPage(newIndex);
        }
      }

      // ===== HELPERS =====
      function pageKey(page) {
        return page?.src || `page_${currentIndex}`;
      }

      // ===== RENDER =====
      function renderCurrentPage() {
        const frame = document.getElementById("reportFrame");
        const skeleton = document.getElementById("iframeSkeleton");
        skeleton.style.display = "flex";

        const page = pages[currentIndex];
        if (!page) return;

        frame.src = page.src;
        frame.style.height = `${page.height || 1550}px`;

        document.getElementById("pageTitle").textContent =
          page.title || "Sem título";
        document.getElementById("currentIndex").textContent = pages.length
          ? currentIndex + 1
          : 0;
        document.getElementById("totalPages").textContent = pages.length;

        const statusMap = loadStatuses();
        const pageStatus = statusMap[pageKey(page)] || "pendente";

        renderComments();
        atualizarSaida();
        updateDashboardListActiveState();
      }

      function renderDashboardList() {
        const listContainer = document.getElementById("dashboard-list");
        if (!listContainer) return;
        listContainer.innerHTML = pages
          .map(
            (p, i) => `
          <button class="dashboard-btn" onclick="selectPage(${i})">
            <span class="dashboard-indicator"></span>
            ${p.title}
          </button>
        `
          )
          .join("");
        updateDashboardListActiveState();
      }

      function selectPage(index) {
        currentIndex = index;
        renderCurrentPage();
        refreshHeaderInfo();
        setActiveStep(0);
      }

      function updateDashboardListActiveState() {
        document.querySelectorAll(".dashboard-btn").forEach((btn, index) => {
          if (index === currentIndex) {
            btn.classList.add("active");
          } else {
            btn.classList.remove("active");
          }
        });
      }

      function refreshHeaderInfo() {
        const prevBtn = document.querySelector(
          ".nav-controls .nav-btn:first-child"
        );
        const nextBtn = document.querySelector(
          ".nav-controls .nav-btn:last-child"
        );
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex >= pages.length - 1;
      }

      function updateRemoveButton() {
        // Função mantida para compatibilidade
      }

      // ===== EDIT TITLE =====
      function editPageTitle(el) {
        if (el.isContentEditable) return;
        const original = el.textContent;
        el.contentEditable = true;
        el.classList.add("editing");
        el.focus();

        const range = document.createRange();
        range.selectNodeContents(el);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);

        const finish = (commit = true) => {
          el.classList.remove("editing");
          el.contentEditable = false;
          const newTitle = el.textContent.trim();
          if (commit && newTitle && pages[currentIndex]) {
            pages[currentIndex].title = newTitle;
            persistPages();
            atualizarSaida();
            toast("✅ Título atualizado!", "success");
          } else {
            el.textContent = original;
          }
        };
        el.addEventListener("blur", () => finish(true), { once: true });
        el.addEventListener(
          "keydown",
          (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              finish(true);
            }
            if (e.key === "Escape") {
              e.preventDefault();
              finish(false);
            }
          },
          { once: true }
        );
      }

      // ===== STATUS =====
      function loadStatuses() {
        try {
          return JSON.parse(
            localStorage.getItem(CONFIG.STORAGE_KEYS.STATUS) || "{}"
          );
        } catch {
          return {};
        }
      }

      function saveStatuses(map) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.STATUS, JSON.stringify(map));
      }

      function savePageStatus() {
        const map = loadStatuses();
        const pageStatus = "validado";
        map[pageKey(pages[currentIndex])] = pageStatus;
        saveStatuses(map);
        atualizarSaida();
      }

      // ===== PAGE ACTIONS =====
      function openCurrentInNewTab() {
        const p = pages[currentIndex];
        if (p?.src) window.open(p.src, "_blank", "noopener");
      }

      // ===== COMMENTS =====
      function getCommentsMap() {
        try {
          return JSON.parse(
            localStorage.getItem(CONFIG.STORAGE_KEYS.COMMENTS) || "{}"
          );
        } catch {
          return {};
        }
      }

      function saveCommentsMap(map) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.COMMENTS, JSON.stringify(map));
      }

      function currentComments() {
        const map = getCommentsMap();
        return map[pageKey(pages[currentIndex])] || [];
      }

      function renderComments() {
        const list = document.getElementById("commentList");
        list.innerHTML = "";
        currentComments().forEach((c, idx) => {
          const li = document.createElement("li");
          li.className = "comment-item fade-in";
          li.innerHTML = `
            <div class="comment-meta">
              <span class="comment-tag">${c.tag}</span>
              <span class="comment-info">${
                c.author ? c.author + " • " : ""
              }${new Date(c.createdAt).toLocaleString("pt-BR")}</span>
            </div>
            <div class="comment-text">${escapeHTML(c.text).replace(
              /\n/g,
              "<br>"
            )}</div>
            <div class="comment-actions">
              <button class="btn-tiny" onclick="deleteComment(${idx})">Remover</button>
            </div>`;
          list.appendChild(li);
        });
      }

      function addComment() {
        const author = document.getElementById("commentAuthor").value.trim();
        const tag = document.getElementById("commentTag").value;
        const text = document.getElementById("commentText").value.trim();
        if (!text) {
          toast("⚠️ Escreva um comentário.", "warning");
          return;
        }
        const map = getCommentsMap();
        const key = pageKey(pages[currentIndex]);
        map[key] = map[key] || [];
        map[key].push({
          author,
          tag,
          text,
          createdAt: new Date().toISOString(),
        });
        saveCommentsMap(map);
        document.getElementById("commentText").value = "";
        renderComments();
        atualizarSaida();
        toast("💬 Comentário adicionado!", "success");
      }

      function deleteComment(index) {
        const map = getCommentsMap();
        const key = pageKey(pages[currentIndex]);
        (map[key] || []).splice(index, 1);
        saveCommentsMap(map);
        renderComments();
        atualizarSaida();
      }

      function clearComments() {
        const key = pageKey(pages[currentIndex]);
        const map = getCommentsMap();
        map[key] = [];
        saveCommentsMap(map);
        renderComments();
        atualizarSaida();
        toast("🧹 Comentários limpos!", "success");
      }

      function exportCommentsCSV() {
        const rows = [];
        pages.forEach((p, i) => {
          const key = pageKey(p);
          const list = getCommentsMap()[key] || [];
          const status = loadStatuses()[key] || "pendente";
          if (!list.length) {
            rows.push([i + 1, p.title, status, "", "", ""]);
          } else {
            list.forEach((c) =>
              rows.push([
                i + 1,
                p.title,
                status,
                c.tag,
                c.author || "",
                c.text.replace(/\n/g, " "),
              ])
            );
          }
        });
        const csv = ["Indice,Título,Status,Tag,Autor,Comentário"]
          .concat(
            rows.map((r) =>
              r.map((s) => `"${String(s || "").replace(/"/g, '""')}"`).join(",")
            )
          )
          .join("\n");
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `comentarios-sicredi-${new Date()
          .toISOString()
          .slice(0, 10)}.csv`;
        a.click();
        URL.revokeObjectURL(a.href);
      }

      // ===== AUTOSAVE / TEMPLATES =====
      function setupAutoSave() {
        document.querySelectorAll(".editor").forEach((ed) => {
          const saved = localStorage.getItem(
            CONFIG.STORAGE_KEYS.AUTO_SAVE + ed.id
          );
          if (saved) ed.innerText = saved;
          ed.addEventListener(
            "input",
            debounce(() => {
              localStorage.setItem(
                CONFIG.STORAGE_KEYS.AUTO_SAVE + ed.id,
                ed.innerText
              );
              toast("💾 Conteúdo salvo!", "info", 1800);
              atualizarSaida();
            }, CONFIG.AUTOSAVE_DELAY)
          );
        });
      }

      function saveTemplate(fieldId) {
        const content = document.getElementById(fieldId).innerText.trim();
        if (!content) return toast("⚠️ Campo vazio.", "warning");
        const name = prompt(
          "Nome do template:",
          `${fieldId}_${new Date().toISOString().slice(0, 10)}`
        );
        if (!name) return;
        const all = getTemplates();
        all[name] = { fieldId, content, created: new Date().toISOString() };
        localStorage.setItem(
          CONFIG.STORAGE_KEYS.TEMPLATES,
          JSON.stringify(all)
        );
        toast(`💾 Template "${name}" salvo!`, "success");
      }

      function loadTemplate(fieldId) {
        const all = getTemplates();
        const names = Object.keys(all).filter(
          (n) => all[n].fieldId === fieldId
        );
        if (!names.length)
          return toast("ℹ️ Nenhum template para este campo.", "info");
        const list = names.map((n) => `• ${n}`).join("\n");
        const pick = prompt(
          `Templates disponíveis:\n${list}\n\nDigite o nome:`
        );
        if (pick && all[pick]) {
          document.getElementById(fieldId).innerText = all[pick].content;
          atualizarSaida();
          toast(`📂 Template "${pick}" carregado!`, "success");
        }
      }

      function getTemplates() {
        try {
          return JSON.parse(
            localStorage.getItem(CONFIG.STORAGE_KEYS.TEMPLATES) || "{}"
          );
        } catch {
          return {};
        }
      }

      // ===== PDF EXPORT =====
      function safeTitle(s) {
        return (s || "relatorio").toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/^-+|-+$/g, "");
      }

      const sleep = (ms) => new Promise(r => setTimeout(r, ms));

      async function ensureShotFor(p) {
        let shot = getShotForPage?.(p);
        if (shot) return shot;

        const url = `${CAPTURE_ENDPOINT}?url=${encodeURIComponent(p.src)}&w=${p.width||600}&h=${p.height||1500}`;
        const res = await fetch(url);
        if (res.status === 401) {
          toast?.("🔒 Sessão Google expirada. Rode `npm run login` e tente novamente.", "warning", 4000);
          throw new Error("LOGIN_REQUIRED");
        }
        if (!res.ok) throw new Error("CAPTURE_FAIL");
        const json = await res.json();
        if (!json?.ok || !json?.dataUrl) throw new Error("RES_INVALID");

        setShotForPage?.(p, json.dataUrl);
        return json.dataUrl;
      }

      function buildNotesHtml(p) {
        const analise = (document.getElementById("analise")?.innerText || "").trim();
        const criticos = (document.getElementById("criticos")?.innerText || "").trim();

        const ul = document.getElementById("commentList");
        const comments = [];
        if (ul) {
          ul.querySelectorAll("li").forEach(li => {
            const text = (li.querySelector(".comment-text")?.innerText || "").trim();
            const tag = (li.querySelector(".comment-tag")?.innerText || "").trim();
            if (text) comments.push({ text, tag });
          });
        }

        const fmt = (txt) => {
          if (!txt) return '<p class="empty">— Sem conteúdo informado —</p>';
          const lines = txt.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
          if (lines.length === 1) return `<p>${escapeHtml(lines[0])}</p>`;
          return `<ul class="print-list">` + lines.map(l => `<li>${escapeHtml(l)}</li>`).join("") + `</ul>`;
        };

        const header = `
          <div class="print-meta">
            <div><strong>${escapeHtml(p.title || "Relatório")}</strong></div>
            <div>${new Date().toLocaleDateString("pt-BR")}</div>
          </div>
          <h1>Notas do Analista</h1>
          <h2>Análise</h2>
          <div class="print-card">${fmt(analise)}</div>
        `;

        const blocos = [header];

        if (criticos) {
          blocos.push(`
            <h2>Pontos Críticos</h2>
            <div class="print-card">${fmt(criticos)}</div>
          `);
        }

        return blocos.join("");
      }

      function escapeHtml(s) {
        return s.replace(/[&<>"']/g, (m) => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
      }

      // Fatia um canvas 2x do html2canvas em partes com altura de uma página (em px 1x)
      function sliceCanvasIntoDataUrls(canvas, pageH_px) {
        const scale = 2;                      // usamos scale:2 no html2canvas
        const sliceH2x = pageH_px * scale;    // altura do corte no canvas 2x
        const slices = [];
        let y = 0;

        while (y < canvas.height) {
          const h = Math.min(sliceH2x, canvas.height - y);
          const tmp = document.createElement("canvas");
          tmp.width = canvas.width;
          tmp.height = h;
          const ctx = tmp.getContext("2d");
          ctx.drawImage(canvas, 0, y, canvas.width, h, 0, 0, canvas.width, h);
          slices.push(tmp.toDataURL("image/png"));
          y += h;
        }
        return slices;
      }

      async function renderNotesPageForPdf(p) {
        const root = document.getElementById("notesPrintRoot");
        if (!root) throw new Error("notesPrintRoot missing");
        root.innerHTML = buildNotesHtml(p);
        root.classList.remove("hidden");

        await sleep(0);
        const canvas = await html2canvas(root, {
          backgroundColor: "#ffffff",
          scale: 2,
          useCORS: true,
          windowWidth: 600
        });

        const height = canvas.height / 2; // altura "1x" do conteúdo
        root.classList.add("hidden");
        root.innerHTML = "";
        return { canvas, height };
      }

      async function exportCurrentAsTwoPagesPDF() {
        setActiveStep(2);

        try {
          const p = pages[currentIndex];
          if (!p) return;

          const shot = await ensureShotFor(p);

          const pageW = p.width  || 600;
          const pageH = p.height || 1500;

          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF({ unit: "px", format: [pageW, pageH], compress: true });

          // Página 1: screenshot do dashboard no tamanho fixo
          pdf.addImage(shot, "PNG", 0, 0, pageW, pageH, undefined, "SLOW");

          // Páginas seguintes: Notas (Análise / Pontos Críticos)
          const { canvas, height } = await renderNotesPageForPdf(p);

          if (height <= pageH) {
            // Cabe em 1 página: mantém o MESMO tamanho da 1ª folha
            pdf.addPage([pageW, pageH]);
            pdf.addImage(canvas.toDataURL("image/png"), "PNG", 0, 0, pageW, height, undefined, "SLOW");
          } else {
            // Quebra em múltiplas páginas do MESMO tamanho da 1ª folha
            const slices = sliceCanvasIntoDataUrls(canvas, pageH);
            for (let i = 0; i < slices.length; i++) {
              // Altura visível da fatia (1x). A última pode ser menor que pageH.
              const remaining = height - i * pageH;
              const drawH = Math.min(pageH, remaining);

              pdf.addPage([pageW, pageH]);
              pdf.addImage(slices[i], "PNG", 0, 0, pageW, drawH, undefined, "SLOW");
            }
          }

          pdf.save(`${safeTitle(p.title)}.pdf`);
          toast?.("✅ PDF gerado com sucesso!", "success");
        } catch (err) {
          console.error(err);
          const msg = (err && err.message === "LOGIN_REQUIRED")
            ? "🔒 Sessão expirada. Rode `npm run login`."
            : "⚠ Não foi possível gerar o PDF.";
          toast?.(msg, "error");
        } finally {
          setActiveStep(0);
        }
      }

      function showPDFOptions(){ exportCurrentAsTwoPagesPDF(); }

      // ===== REPORT PREVIEW =====
      function atualizarSaida() {
        const analise =
          document.getElementById("analise").innerText.trim() ||
          "Nenhuma análise informada.";
        const criticos =
          document.getElementById("criticos").innerText.trim() ||
          "Nenhum ponto crítico informado.";
        const now = new Date().toLocaleString("pt-BR");

        // Atualizado para uma visualização mais limpa
        document.getElementById("saida").innerHTML = `
          <div style="padding: 2rem; background: white; border-radius: 16px; margin: 2rem 0;">
            <h2 style="color: var(--sicredi-green); margin-bottom: 1rem;">Relatório Sicredi</h2>
            <div style="text-align:center;margin-bottom:20px;color:#666;font-style:italic">
              <em>Gerado em ${now}</em>
            </div>
          </div>`;
      }

      function scrollToReport() {
        document
          .getElementById("saida")
          ?.scrollIntoView({ behavior: "smooth" });
      }

      // ===== UTILITIES =====
      function debounce(fn, wait) {
        let t;
        return (...a) => {
          clearTimeout(t);
          t = setTimeout(() => fn(...a), wait);
        };
      }

      function escapeHTML(s) {
        return String(s || "").replace(
          /[&<>"']/g,
          (m) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[m])
        );
      }

      function toast(message, type = "info", ms = 2500) {
        document.querySelector(".notification")?.remove();
        const n = document.createElement("div");
        n.className = `notification ${type}`;
        n.textContent = message;
        document.body.appendChild(n);
        setTimeout(() => n.classList.add("show"), 10);
        setTimeout(() => {
          n.classList.remove("show");
          setTimeout(() => n.remove(), 300);
        }, ms);
      }

      function setupKeyboardNavigation() {
        document.addEventListener("keydown", (e) => {
          if (e.ctrlKey || e.metaKey) {
            if (e.key === "s") {
              e.preventDefault();
              showPDFOptions();
            }
            if (e.key === "r") {
              e.preventDefault();
              scrollToReport();
            }
          }
          if (e.key === "ArrowLeft" && !e.target.isContentEditable) prevPage();
          if (e.key === "ArrowRight" && !e.target.isContentEditable) nextPage();
        });
      }

      // ===== HELP MODAL =====
      function showHelpModal() {
        document.getElementById("modalRoot").innerHTML = `
          <div class="modal-overlay show">
            <div class="modal">
              <h3>Como usar o Sistema</h3>
              <p><strong>1. Escolha o Dashboard:</strong> Selecione um dos relatórios disponíveis na lista à esquerda.</p>
              <p><strong>2. Adicione Análises:</strong> Preencha os campos de análise e pontos críticos.</p>
              <p><strong>3. Adicione Comentários:</strong> Registre observações específicas para cada página.</p>
              <p><strong>4. Exporte o PDF:</strong> Gere o relatório final com todas as informações consolidadas.</p>
              <p style="margin-top: 1rem;"><em>Dica: Use Ctrl+S para exportar rapidamente o PDF!</em></p>
              <div class="modal-buttons">
                <button class="modal-btn primary" onclick="closeModal()">Entendi!</button>
              </div>
            </div>
          </div>`;
      }

      function closeModal() {
        document.getElementById("modalRoot").innerHTML = "";
      }
    </script>
  </body>
</html><!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sicredi Report Dashboard</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
      /* ===== VARIÁVEIS E RESET ===== */
      :root {
        --sicredi-green: #00a651;
        --sicredi-dark: #004d2d;
        --sicredi-light: #e6f5ed;
        --sicredi-accent: #28a745;
        --text-primary: #1a1f2e;
        --text-secondary: #64748b;
        --border-color: #e2e8f0;
        --bg-primary: #ffffff;
        --bg-secondary: #f8fafc;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 12px rgba(0, 166, 81, 0.08);
        --shadow-lg: 0 10px 40px rgba(0, 166, 81, 0.12);
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 24px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Arial, sans-serif;
        background: linear-gradient(180deg, #f0fdf5 0%, #ffffff 100%);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* ===== HEADER MODERNO ===== */
      .header {
        background: linear-gradient(135deg, var(--sicredi-green) 0%, var(--sicredi-accent) 100%);
        position: relative;
        overflow: hidden;
        box-shadow: 0 10px 40px rgba(0, 166, 81, 0.15);
      }

      .header::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -10%;
        width: 50%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: float 20s ease-in-out infinite;
      }

      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(180deg); }
      }

      .header-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2.5rem 2rem;
        position: relative;
        z-index: 2;
      }

      .header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .logo-section {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .logo-icon {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        backdrop-filter: blur(10px);
        background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="white"><path d="M20 20h15v15H20z M35 20h15v15H35z M50 20h15v15H50z M65 20h15v15H65z M20 35h15v15H20z M65 35h15v15H65z M20 50h15v15H20z M35 50h15v15H35z M50 50h15v15H50z M65 50h15v15H65z M20 65h15v15H20z M35 65h15v15H35z M50 65h15v15H50z M65 65h15v15H65z"/></svg>');
        background-size: 24px;
        background-repeat: no-repeat;
        background-position: center;
      }

      .header h1 {
        font-size: 2rem;
        font-weight: 700;
        color: white;
        letter-spacing: -0.5px;
      }

      .header-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.95rem;
        font-weight: 400;
      }

      .header-actions {
        display: flex;
        gap: 1rem;
      }

      .header-btn {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-md);
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.9rem;
      }

      .header-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }

      /* ===== HELP BUTTON FLUTUANTE ===== */
      .help-btn {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 1000;
        background: var(--sicredi-green);
        color: white;
        border: none;
        border-radius: 50%;
        width: 56px;
        height: 56px;
        font-size: 1.3rem;
        cursor: pointer;
        box-shadow: 0 8px 24px rgba(0, 166, 81, 0.3);
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .help-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 12px 32px rgba(0, 166, 81, 0.4);
      }

      /* ===== STEPPER APRIMORADO ===== */
      .steps-container {
        background: white;
        border-bottom: 1px solid var(--border-color);
        padding: 1.5rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
      }

      .steps {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        gap: 1rem;
        padding: 0 2rem;
      }

      .step {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        border-radius: var(--radius-lg);
        border: 2px solid var(--border-color);
        background: var(--bg-secondary);
        transition: var(--transition);
        cursor: pointer;
      }

      .step-number {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: white;
        border: 2px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--text-secondary);
        transition: var(--transition);
      }

      .step-content {
        flex: 1;
      }

      .step-title {
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--text-primary);
      }

      .step-desc {
        font-size: 0.75rem;
        color: var(--text-secondary);
      }

      .step.active {
        background: var(--sicredi-light);
        border-color: var(--sicredi-green);
      }

      .step.active .step-number {
        background: var(--sicredi-green);
        border-color: var(--sicredi-green);
        color: white;
      }

      /* ===== CONTAINER PRINCIPAL ===== */
      .container {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 0 2rem;
      }

      .main-grid {
        display: grid;
        grid-template-columns: 380px 1fr;
        gap: 2rem;
        align-items: start;
      }

      /* ===== SIDEBAR MODERNA ===== */
      .sidebar {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
        position: sticky;
        top: 100px;
        max-height: calc(100vh - 120px);
        overflow-y: auto;
        padding-right: 0.5rem;
      }

      .sidebar::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar::-webkit-scrollbar-track {
        background: var(--bg-secondary);
        border-radius: 3px;
      }

      .sidebar::-webkit-scrollbar-thumb {
        background: var(--sicredi-green);
        border-radius: 3px;
      }

      .card {
        background: white;
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
      }

      .card:hover {
        box-shadow: var(--shadow-md);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .card-title {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .card-icon {
        width: 24px;
        height: 24px;
        background: var(--sicredi-light);
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
      }

      /* ===== LISTA DE DASHBOARDS ===== */
      .dashboard-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .dashboard-btn {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        width: 100%;
        padding: 0.875rem 1rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        text-align: left;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-primary);
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .dashboard-btn::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: transparent;
        transition: var(--transition);
      }

      .dashboard-btn:hover {
        background: white;
        border-color: var(--sicredi-green);
        transform: translateX(4px);
      }

      .dashboard-btn.active {
        background: var(--sicredi-light);
        border-color: var(--sicredi-green);
        color: var(--sicredi-dark);
        font-weight: 600;
      }

      .dashboard-btn.active::before {
        background: var(--sicredi-green);
      }

      .dashboard-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--text-secondary);
        transition: var(--transition);
      }

      .dashboard-btn.active .dashboard-indicator {
        background: var(--sicredi-green);
        box-shadow: 0 0 0 3px rgba(0, 166, 81, 0.2);
      }

      /* ===== EDITOR CAMPOS ===== */
      .editor-container {
        position: relative;
      }

      .editor {
        width: 100%;
        min-height: 120px;
        padding: 1rem;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        background: var(--bg-secondary);
        font-size: 0.9rem;
        resize: vertical;
        outline: none;
        transition: var(--transition);
        font-family: inherit;
      }

      .editor:focus {
        border-color: var(--sicredi-green);
        background: white;
        box-shadow: 0 0 0 4px rgba(0, 166, 81, 0.1);
      }

      .editor:empty::before {
        content: attr(data-placeholder);
        color: var(--text-secondary);
        font-style: italic;
      }

      .template-controls {
        display: flex;
        gap: 0.5rem;
      }

      .template-btn {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        padding: 0.5rem;
        cursor: pointer;
        font-size: 0.875rem;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
      }

      .template-btn:hover {
        background: var(--sicredi-light);
        border-color: var(--sicredi-green);
      }

      /* ===== ÁREA DO RELATÓRIO ===== */
      .report-area {
        background: white;
        border-radius: var(--radius-xl);
        overflow: hidden;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-color);
      }

      .report-header {
        background: linear-gradient(135deg, var(--sicredi-green) 0%, var(--sicredi-accent) 100%);
        padding: 1.5rem;
      }

      .report-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .nav-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: white;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .nav-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .nav-btn {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: none;
        border-radius: var(--radius-md);
        width: 40px;
        height: 40px;
        color: white;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
      }

      .nav-btn:hover:not(:disabled) {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      .nav-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .page-counter {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        padding: 0.5rem 1.25rem;
        border-radius: var(--radius-xl);
        font-weight: 500;
        color: white;
      }

      .page-toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .page-title {
        font-weight: 600;
        color: white;
        cursor: pointer;
        padding: 0.5rem 0.75rem;
        border-radius: var(--radius-md);
        transition: var(--transition);
        background: rgba(255, 255, 255, 0.1);
      }

      .page-title:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .page-title.editing {
        background: white;
        color: var(--sicredi-green);
        outline: none;
      }

      .page-actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        align-items: center;
      }

      .btn-action {
        background: rgba(255, 255, 255, 0.9);
        color: var(--sicredi-green);
        border: none;
        border-radius: var(--radius-md);
        padding: 0.625rem 1.25rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-action:hover {
        background: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      /* ===== IFRAME CONTAINER ===== */
      .iframe-container {
        position: relative;
        background: var(--bg-secondary);
        min-height: 600px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .iframe-skeleton {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1rem;
      }

      .skeleton-loader {
        width: 48px;
        height: 48px;
        border: 4px solid var(--border-color);
        border-top-color: var(--sicredi-green);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      .skeleton-text {
        color: var(--text-secondary);
        font-weight: 500;
        font-size: 0.95rem;
      }

      #reportFrame {
        width: 100%;
        height: 1500px;
        border: 0;
        display: block;
      }

      /* ===== SEÇÃO DE COMENTÁRIOS ===== */
      .comments-section {
        padding: 2rem;
        background: var(--bg-secondary);
        border-top: 1px solid var(--border-color);
        display: none !important;
      }

      .comments-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .comments-title {
        font-weight: 600;
        font-size: 1.125rem;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .comments-actions {
        display: flex;
        gap: 0.75rem;
      }

      .btn-sm {
        background: white;
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-sm:hover {
        background: var(--sicredi-light);
        border-color: var(--sicredi-green);
        color: var(--sicredi-green);
      }

      .comment-form {
        background: white;
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
      }

      .comment-form-grid {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .comment-form input,
      .comment-form select,
      .comment-form textarea {
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 0.75rem;
        font-family: inherit;
        font-size: 0.875rem;
        transition: var(--transition);
        background: var(--bg-secondary);
      }

      .comment-form textarea {
        width: 100%;
        min-height: 100px;
        resize: vertical;
      }

      .comment-form input:focus,
      .comment-form select:focus,
      .comment-form textarea:focus {
        outline: none;
        border-color: var(--sicredi-green);
        background: white;
        box-shadow: 0 0 0 4px rgba(0, 166, 81, 0.1);
      }

      .comment-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .comment-item {
        background: white;
        border-radius: var(--radius-lg);
        padding: 1.25rem;
        border: 1px solid var(--border-color);
        transition: var(--transition);
        position: relative;
        padding-left: 1.75rem;
      }

      .comment-item::before {
        content: "";
        position: absolute;
        left: 0.5rem;
        top: 1.25rem;
        width: 4px;
        height: calc(100% - 2.5rem);
        background: var(--sicredi-light);
        border-radius: 2px;
      }

      .comment-item:hover {
        box-shadow: var(--shadow-md);
        transform: translateX(4px);
      }

      .comment-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
      }

      .comment-tag {
        background: var(--sicredi-light);
        color: var(--sicredi-dark);
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-xl);
        font-size: 0.75rem;
        font-weight: 600;
      }

      .comment-info {
        color: var(--text-secondary);
        font-size: 0.75rem;
      }

      .comment-text {
        color: var(--text-primary);
        white-space: pre-wrap;
        line-height: 1.5;
        margin-bottom: 0.75rem;
      }

      .comment-actions {
        text-align: right;
      }

      .btn-tiny {
        background: transparent;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
        color: var(--text-secondary);
        cursor: pointer;
        transition: var(--transition);
      }

      .btn-tiny:hover {
        background: #fee2e2;
        border-color: #ef4444;
        color: #ef4444;
      }

      /* ===== BOTÕES PRINCIPAIS ===== */
      .pdf-controls {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin: 3rem 0;
        padding: 0 2rem;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--sicredi-green) 0%, var(--sicredi-accent) 100%);
        color: white;
        border: none;
        border-radius: var(--radius-xl);
        padding: 1rem 2.5rem;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 8px 24px rgba(0, 166, 81, 0.25);
        transition: var(--transition);
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 32px rgba(0, 166, 81, 0.35);
      }

      .btn-secondary {
        background: white;
        color: var(--sicredi-green);
        border: 2px solid var(--sicredi-green);
        border-radius: var(--radius-xl);
        padding: 1rem 2.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .btn-secondary:hover {
        background: var(--sicredi-light);
        transform: translateY(-3px);
      }

      /* ===== MODAL MODERNA ===== */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        opacity: 0;
        transition: opacity 0.3s ease;
        backdrop-filter: blur(8px);
      }

      .modal-overlay.show {
        opacity: 1;
      }

      .modal {
        background: white;
        border-radius: var(--radius-xl);
        padding: 2rem;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        transform: scale(0.9) translateY(20px);
        transition: transform 0.3s ease;
      }

      .modal-overlay.show .modal {
        transform: scale(1) translateY(0);
      }

      .modal h3 {
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .modal p {
        color: var(--text-secondary);
        line-height: 1.6;
        margin-bottom: 1rem;
      }

      .modal-buttons {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        margin-top: 2rem;
      }

      .modal-btn {
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-md);
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.875rem;
      }

      .modal-btn.primary {
        background: var(--sicredi-green);
        color: white;
      }

      .modal-btn.primary:hover {
        background: var(--sicredi-dark);
      }

      .modal-btn.secondary {
        background: var(--bg-secondary);
        color: var(--text-primary);
      }

      .modal-btn.secondary:hover {
        background: var(--border-color);
      }

      .modal-btn.remove-btn {
        background: #ef4444;
        color: white;
      }

      .modal-btn.remove-btn:hover {
        background: #dc2626;
      }

      .modal input,
      .modal textarea {
        width: 100%;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 0.75rem;
        margin: 0.5rem 0;
        font-family: inherit;
        transition: var(--transition);
      }

      .modal input:focus,
      .modal textarea:focus {
        outline: none;
        border-color: var(--sicredi-green);
        box-shadow: 0 0 0 4px rgba(0, 166, 81, 0.1);
      }

      /* ===== NOTIFICAÇÃO TOAST ===== */
      .notification {
        position: fixed;
        top: 2rem;
        right: 2rem;
        background: white;
        color: var(--text-primary);
        padding: 1rem 1.5rem;
        border-radius: var(--radius-lg);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        transform: translateX(calc(100% + 2rem));
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        z-index: 10002;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        border-left: 4px solid var(--sicredi-green);
        max-width: 400px;
      }

      .notification.show {
        transform: translateX(0);
        opacity: 1;
      }

      .notification.success {
        border-left-color: #10b981;
      }

      .notification.error {
        border-left-color: #ef4444;
      }

      .notification.info {
        border-left-color: #3b82f6;
      }

      .notification.warning {
        border-left-color: #f59e0b;
      }

      /* ===== MOBILE MENU ===== */
      .mobile-menu-btn {
        display: none;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 0.75rem;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition);
      }

      .mobile-sidebar-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .mobile-sidebar-overlay.show {
        display: block;
        opacity: 1;
      }

      /* ===== RESPONSIVIDADE ===== */
      @media (max-width: 1200px) {
        .main-grid {
          grid-template-columns: 320px 1fr;
        }
      }

      @media (max-width: 1024px) {
        .container {
          padding: 0 1rem;
        }

        .steps-container {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .steps {
          min-width: 600px;
          padding: 0 1rem;
        }

        .main-grid {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }

        .sidebar {
          position: fixed;
          left: -100%;
          top: 0;
          bottom: 0;
          width: 320px;
          background: white;
          z-index: 1000;
          padding: 2rem 1.5rem;
          transition: left 0.3s ease;
          box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
          max-height: 100vh;
        }

        .sidebar.show {
          left: 0;
        }

        .mobile-menu-btn {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.5rem;
        }

        .header-top {
          flex-direction: column;
          gap: 1rem;
          align-items: flex-start;
        }

        .header-actions {
          width: 100%;
        }

        .header-btn {
          flex: 1;
          text-align: center;
        }

        .step {
          flex-direction: column;
          text-align: center;
          padding: 1rem;
        }

        .page-toolbar {
          flex-direction: column;
          gap: 1rem;
          align-items: stretch;
        }

        .page-actions {
          justify-content: center;
        }

        .comment-form-grid {
          grid-template-columns: 1fr;
        }

        .pdf-controls {
          flex-direction: column;
          align-items: stretch;
        }

        .btn-primary,
        .btn-secondary {
          width: 100%;
          justify-content: center;
        }

        .help-btn {
          bottom: 1rem;
          right: 1rem;
          width: 48px;
          height: 48px;
        }
      }

      @media (max-width: 480px) {
        .header-content {
          padding: 1.5rem 1rem;
        }

        .modal {
          width: 95%;
          padding: 1.5rem;
        }

        .comment-item {
          padding: 1rem;
          padding-left: 1.5rem;
        }
      }

      /* ===== PRINT STYLES ===== */
      .print-root {
        width: 600px;
        background: white;
        color: var(--text-primary);
        padding: 24px;
        box-sizing: border-box;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      }

      .print-root h1 {
        font-size: 18px;
        margin: 0 0 10px;
        color: var(--sicredi-green);
      }

      .print-root h2 {
        font-size: 16px;
        margin: 18px 0 8px;
        color: var(--sicredi-dark);
      }

      .print-root p {
        margin: 6px 0;
        line-height: 1.65;
      }

      .print-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 14px;
        font-size: 12px;
        color: var(--text-secondary);
      }

      .print-card {
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 14px;
        margin-top: 10px;
        background: var(--bg-secondary);
      }

      .print-list {
        margin: 8px 0 0 0;
        padding-left: 18px;
      }

      .print-list li {
        margin: 4px 0;
      }

      .print-comments .c-item {
        border-top: 1px dashed var(--border-color);
        padding-top: 8px;
        margin-top: 8px;
      }

      .print-tag {
        display: inline-block;
        font-size: 11px;
        border-radius: 999px;
        padding: 2px 8px;
        background: var(--sicredi-light);
        color: var(--sicredi-dark);
        margin-left: 6px;
      }

      .empty {
        color: var(--text-secondary);
        font-style: italic;
      }

      /* ===== UTILITIES ===== */
      .hidden {
        display: none !important;
      }

      .text-center {
        text-align: center;
      }

      .mt-1 { margin-top: 0.5rem; }
      .mt-2 { margin-top: 1rem; }
      .mt-3 { margin-top: 1.5rem; }
      .mt-4 { margin-top: 2rem; }

      .mb-1 { margin-bottom: 0.5rem; }
      .mb-2 { margin-bottom: 1rem; }
      .mb-3 { margin-bottom: 1.5rem; }
      .mb-4 { margin-bottom: 2rem; }

      /* ===== ANIMAÇÕES ===== */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in {
        animation: fadeIn 0.3s ease;
      }

      @keyframes pulse {
        0%, 100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      /* ===== FOCUS VISIBLE ===== */
      *:focus-visible {
        outline: 2px solid var(--sicredi-green);
        outline-offset: 2px;
      }

      /* ===== SELECTION ===== */
      ::selection {
        background: var(--sicredi-light);
        color: var(--sicredi-dark);
      }

      /* ===== SCROLLBAR ===== */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-secondary);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--sicredi-green);
        border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--sicredi-dark);
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="header-top">
          <div class="logo-section">
            <div class="logo-icon"></div>
            <div>
              <h1>Sicredi Report</h1>
              <div class="header-subtitle">Dashboard de Análise</div>
            </div>
          </div>
          <div class="header-actions">
            <button class="mobile-menu-btn" onclick="toggleMobileSidebar()">☰ Menu</button>
            <button class="header-btn" onclick="showHelpModal()">? Ajuda</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Steps Container -->
    <div class="steps-container">
      <div class="steps">
        <div class="step active">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">Escolher Dashboard</div>
            <div class="step-desc">Selecione o relatório para analisar</div>
          </div>
        </div>
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">Adicionar Análises</div>
            <div class="step-desc">Preencha campos de análise</div>
          </div>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">Adicionar Comentários</div>
            <div class="step-desc">Registre observações específicas</div>
          </div>
        </div>
        <div class="step">
          <div class="step-number">4</div>
          <div class="step-content">
            <div class="step-title">Exportar PDF</div>
            <div class="step-desc">Gere o relatório final</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Container Principal -->
    <div class="container">
      <div class="main-grid">
        <!-- Sidebar -->
        <div class="sidebar">
          <!-- Lista de Dashboards -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <div class="card-icon">📊</div>
                Dashboards Disponíveis
              </div>
            </div>
            <div id="dashboard-list" class="dashboard-list"></div>
          </div>

          <!-- Análise -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <div class="card-icon">📝</div>
                Análise
              </div>
              <div class="template-controls">
                <button class="template-btn" onclick="saveTemplate('analise')" title="Salvar Template">💾</button>
                <button class="template-btn" onclick="loadTemplate('analise')" title="Carregar Template">📂</button>
              </div>
            </div>
            <div class="editor-container">
              <div id="analise" class="editor" contenteditable="true" data-placeholder="Digite sua análise aqui..."></div>
            </div>
          </div>

          <!-- Pontos Críticos -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <div class="card-icon">⚠️</div>
                Pontos Críticos
              </div>
              <div class="template-controls">
                <button class="template-btn" onclick="saveTemplate('criticos')" title="Salvar Template">💾</button>
                <button class="template-btn" onclick="loadTemplate('criticos')" title="Carregar Template">📂</button>
              </div>
            </div>
            <div class="editor-container">
              <div id="criticos" class="editor" contenteditable="true" data-placeholder="Digite os pontos críticos aqui..."></div>
            </div>
          </div>
        </div>

        <!-- Área do Relatório -->
        <div class="report-area">
          <!-- Report Header -->
          <div class="report-header">
            <div class="report-nav">
              <div class="nav-title">
                📈 Relatório
              </div>
              <div class="nav-controls">
                <button class="nav-btn" onclick="prevPage()" title="Página Anterior">←</button>
                <div class="page-counter">
                  <span id="currentIndex">0</span> / <span id="totalPages">0</span>
                </div>
                <button class="nav-btn" onclick="nextPage()" title="Próxima Página">→</button>
              </div>
            </div>
            <div class="page-toolbar">
              <div id="pageTitle" class="page-title" onclick="editPageTitle(this)">Carregando...</div>
              <div class="page-actions">
                <button class="btn-action" onclick="openCurrentInNewTab()">
                  🔗 Abrir Link
                </button>
                <button class="btn-action" onclick="showPDFOptions()">
                  📄 Exportar PDF
                </button>
              </div>
            </div>
          </div>

          <!-- Iframe Container -->
          <div class="iframe-container">
            <div id="iframeSkeleton" class="iframe-skeleton">
              <div class="skeleton-loader"></div>
              <div class="skeleton-text">Carregando página...</div>
            </div>
            <iframe id="reportFrame" src="about:blank"></iframe>
          </div>

          <!-- Comments Section -->
          <div class="comments-section">
            <div class="comments-header">
              <div class="comments-title">
                💬 Comentários da Página
              </div>
              <div class="comments-actions">
                <button class="btn-sm" onclick="clearComments()">
                  🧹 Limpar
                </button>
                <button class="btn-sm" onclick="exportCommentsCSV()">
                  📊 Exportar CSV
                </button>
              </div>
            </div>

            <!-- Comment Form -->
            <div class="comment-form">
              <div class="comment-form-grid">
                <input id="commentAuthor" type="text" placeholder="Seu nome (opcional)">
                <select id="commentTag">
                  <option value="info">ℹ️ Informativo</option>
                  <option value="warning">⚠️ Atenção</option>
                  <option value="critical">🚨 Crítico</option>
                  <option value="suggestion">💡 Sugestão</option>
                </select>
              </div>
              <textarea id="commentText" placeholder="Digite seu comentário..."></textarea>
              <button class="btn-primary" onclick="addComment()">
                ➕ Adicionar Comentário
              </button>
            </div>

            <!-- Comments List -->
            <ul id="commentList" class="comment-list"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- PDF Export Controls -->
    <div class="pdf-controls">
      <button class="btn-primary" onclick="showPDFOptions()">
        📄 Exportar PDF Completo
      </button>
      <button class="btn-secondary" onclick="scrollToReport()">
        📋 Ver Prévia do Relatório
      </button>
    </div>

    <!-- Saída do Relatório -->
    <div id="saida"></div>

    <!-- Mobile Sidebar Overlay -->
    <div class="mobile-sidebar-overlay" onclick="toggleMobileSidebar()"></div>

    <!-- Help Button -->
    <button class="help-btn" onclick="showHelpModal()">?</button>

    <!-- Modal Root -->
    <div id="modalRoot"></div>

    <!-- Print Root (Hidden) -->
    <div id="notesPrintRoot" class="print-root hidden"></div>

    <script>
      // ===== IMPORTANTE =====
      // Para que o sistema funcione corretamente, é necessário que alguns cookies sejam definidos.
      // Estes cookies são usados para autenticação e configuração do ambiente.
      // Não remova ou altere esta seção sem entender as consequências.

      function setCookie(name, value, days) {
        const expires = new Date(Date.now() + days * 864e5).toUTCString();
        document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
      }

      // Defina aqui os cookies importantes para o funcionamento do sistema.
      const importantCookies = {
        // Exemplo:
        // 'cookie_name': 'cookie_value',
      };

      setCookie(...importantCookies);
    </script>
   </body>
</html>